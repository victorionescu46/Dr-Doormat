<?php
class Wdc_Checkout_Block_Cart extends Mage_Checkout_Block_Cart 
{
	public function checkGrain($productId)
	{
		$check = new Wdc_Checkout_Model_Cartdata();
		return $check->isGrain($productId);	
	}
	
	public function updategrainCrush($itemId, $grain=false)
	{
		$crusher = new Wdc_Checkout_Model_Cartdata();
		$crusher->updateCartDescGrain($itemId, $grain);
	}
	
	public function getProductNameCart($itemId)
	{
		$myName = new Wdc_Checkout_Model_Cartdata();	
		$row = $myName->_getCartRow($itemId);
		return $row['name'];
	}
	
	public function checkNotCrush($itemId)
	{
		$check = new Wdc_Checkout_Model_Cartdata();
		return $check->_containsNotCrush($itemId);	
	}
		
	public function addListCart($sid)
	{
		$madeit = true;
		Mage::getSingleton('core/session', array('name' => 'frontend'));
		$o = new Wdc_QuickOrder_Model_Listloader();
		$list = $o->getArrayList($sid);
		
		if($list)
		{
			$cart = Mage::getModel("checkout/cart");
			foreach ($list as $row)
			{
			
				$cart->addProduct((int)$row['entity_id'],(int)$row['qty']);
				
				//$cart->addProduct(1,1);				
			}
			$cart->save();
		}
		else
			{
			$madeit = false;	
			}
		return $madeit;
	}
	
	public function getCrushHtml($itemId)
	{
		$html = ''; 
		if($this->checkNotCrush($itemId))
		 {
			$html.='span class="urgent">***Your grains will be crushed</span><br />';
			$html.='<a class="clickref" onclick="updategrain('.$itemId.', false)">If you would not like your grains crushed, click here</a>';
			}
			else
			{
			$html.='<span class="urgent">***Your grains will be crushed</span><br />';
			$html.='<a class="clickref" onclick="updategrain('.$itemId.', true)">If you would not like your grains <i>NOT CRUSHED</i>, click here</a>';
		}
		return $html;		
	}
	
	public function setCrushRadio($item_id)
	{
		
		$zlabel = '';
		if(!$this->checkOptionExists($item_id))
			{
			$zlabel = '<span class="infotext-red">All grains are defaulted to crush, if this is incorrent please change above<br></span>';	
			}
		$html = ''; 
		$cartData = new Wdc_Checkout_Model_Cartdata();
		
		if($cartData->isGrain($this->getProductId($item_id)))
			{
				
		$html.= '<div id="crush'.$item_id.'">';
		$html.='Crush Grain: ';
			if($this->checkOptionExists($item_id) != 2)
			{
				$html.='<input id="Radio1" type="radio" value="true" name="crush'.$item_id.'" checked onclick="updategrain('.$item_id.',true,true)" /> Yes ';
				$html.='<input id="Radio2" type="radio" value="false" name="crush'.$item_id.'" onclick="updategrain('.$item_id.',false,true)" /> No';	
				$html.='<br>'.$zlabel;
			}
			else
				{
				$html.='<input id="Radio1" type="radio" value="true" name="crush'.$item_id.'" onclick="updategrain('.$item_id.',true,true)" /> Yes ';
				$html.='<input id="Radio2" type="radio" value="false" name="crush'.$item_id.'" checked onclick="updategrain('.$item_id.',false,true)" /> No';	
				}	
			$html.= '</div>';		
			}
		
		return $html;
	}
	
	
	protected function getProductId($item_id)
	{
		$cartData= new Wdc_Checkout_Model_Cartdata();
		return $cartData->_getProductId($item_id);			
	}
	
		
	public function setCrushHtml($item_id)
	{
		$html = ''; 
				
		if(!$this->checkOptionExists($item_id))
			{
			$html.='<span class="urgent">***Your grains will be crushed</span><br />';
			$html.='<a class="clickref" onclick="updategrain('.$item_id.',false,false)">If you would like your grains NOT crushed, click here</a>';			
			}
		else
		{	
			if($this->checkOptionExists($item_id) != 1)
				{
				$html.='<span class="urgent">***Your grains will NOT be crushed</span><br />';
				$html.='<a class="clickref" onclick="updategrain('.$item_id.',true,false)">If you would like your grains crushed, click here (true)</a>';				
				}
			else
			{
				$html.='<span class="urgent">***Your grains will be Crushed</span><br />';
				$html.='<a class="clickref" onclick="updategrain('.$item_id.',false,false)">If you would like your grains <i>NOT CRUSHED</i>, click here (false)</a>';
			}		
			
		}
			
		return $html;
	}
	
	public function isGrainOrder($item_id)
	{
		$grain = false;
		$cartData = new Wdc_Checkout_Model_Cartdata();
		if($cartData->isGrainOrderId($item_id))
		{
			$grain = true;
		}	
		
		return $grain;
	}
	
	public function getCartOptionsLabel($item_id)
	{
		$CartOption = new Wdc_Checkout_Model_Cartdata();	
		return '<span class="infotext-red-ident">'.$CartOption->_getCartOptionLabel($item_id).'</span>';
	}
	
	public function getAdminOptionsLabel($item_id)
	{
		$CartOption = new Wdc_Checkout_Model_Cartdata();	
		return '<span class="infotext-red-ident">'.$CartOption->_getCartOptionLabel($CartOption->_getQuoteItemId($item_id)).'</span>';			
	}
	
	public function setOptionCrush($item_id, $crush)
	{
		$CartOption = new Wdc_Checkout_Model_Cartdata();	
		$CartOption->setCartOptions($item_id, $crush);
	}
	
	protected function checkOptionExists($item_id)
	{
		$CartOption = new Wdc_Checkout_Model_Cartdata();	
		return $CartOption->checkOptionExists($item_id);
	}
	
	
}

?>